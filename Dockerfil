FROM composer

# Create the web dir
RUN mkdir -p /var/www/html

# Set the working directory to /var/www/html
WORKDIR /var/www/html/

COPY . .

RUN cp /usr/local/etc/php/php.ini-production /usr/local/etc/php/php.ini
RUN docker-php-ext-install pdo_mysql

RUN composer update
RUN composer install --no-dev

# RUN php artisan migrate
RUN php artisan storage:link

RUN echo "php artisan serve --host 0.0.0.0 --port 8000&" > /init.sh
RUN echo "php artisan serve --host 0.0.0.0 --port 80" >> /init.sh

RUN chmod +x /init.sh

EXPOSE 80 8000

CMD ["/init.sh"]
